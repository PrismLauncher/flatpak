id: org.prismlauncher.PrismLauncher
runtime: org.kde.Platform
runtime-version: '6.10'
sdk: org.kde.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk17

command: prismlauncher
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --device=all
  - --share=network
  - --socket=pulseaudio
    # for Discord RPC mods
  - --filesystem=xdg-run/app/com.discordapp.Discord:create
    # Mod drag&drop
  - --filesystem=xdg-download:ro
    # FTBApp import
  - --filesystem=~/.ftba:ro
    # Userspace visibility for manual hugepages configuration
    # Required for -XX:+UseLargePages
  - --filesystem=/sys/kernel/mm/hugepages:ro
    # Userspace visibility for transparent hugepages configuration
    # Required for -XX:+UseTransparentHugePages
  - --filesystem=/sys/kernel/mm/transparent_hugepage:ro

modules:
  - modules/cmark.yml
  - modules/gamemode.yml
  - modules/tomlplusplus.yml

  # Text to Speech in the game
  - modules/flite.json

  # Needed for proper Wayland support
  - modules/libdecor.json

  # Required for GPU info
  - modules/glxinfo.yml

  # Required for older Minecraft versions
  - modules/xrandr.yml

  # Our patches improve native Wayland support
  - modules/glfw.yml

  - name: prismlauncher
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DLauncher_BUILD_PLATFORM=flatpak
      # This allows us to manage and update Java independently of this Flatpak
      - -DLauncher_ENABLE_JAVA_DOWNLOADER=ON
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    build-options:
      env:
        JAVA_HOME: /usr/lib/sdk/openjdk17/jvm/openjdk-17
        JAVA_COMPILER: /usr/lib/sdk/openjdk17/jvm/openjdk-17/bin/javac
    run-tests: true
    sources:
      - type: git
        url: https://github.com/PrismLauncher/PrismLauncher
        branch: develop

  - name: enhance
    buildsystem: simple
    build-commands:
      - install -Dm755 prime-run /app/bin/prime-run
      - mv /app/bin/prismlauncher /app/bin/prismrun
      - install -Dm755 prismlauncher /app/bin/prismlauncher
    sources:
      # Script used to wrap instances and ensure they use dGPUs in hyprid configurations
      - type: file
        path: scripts/prime-run
      # Sets up misc integrations with gamemode, mangohud, Discord RPC, etc.
      - type: file
        path: scripts/prismlauncher
